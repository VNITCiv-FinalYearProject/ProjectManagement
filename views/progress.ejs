<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Project Progress</title>
    <link rel="stylesheet" href="/css/progress.css" />
</head>
<body>
    <nav>
        <ul>
            <li><a href="/dashboard">Home</a></li>
            <li><a href="/projects">Projects</a></li>
            <li><a href="#tasks">Notifications</a></li>
            <li><a href="#reports">About</a></li>
        </ul>
    </nav>

    <div class="container">
        <h1>Project Progress</h1>

        <!-- Progress bar section -->
        <div class="progress-container">
            <h3>Overall Project Progress</h3>
            <div class="progress-bar-background">
                <div class="progress-bar-fill" id="progressBar"></div>
            </div>
            <p><strong>Progress:</strong> <%= progressPercentage %>% completed</p>
        </div>

        <!-- Form to add new progress update -->
        <h2>Add New Progress Update</h2>
        <form action="/project/<%= projectId %>/progress/add" method="POST" enctype="multipart/form-data">
            <div class="form-group">
                <label for="image">Upload Image:</label>
                <input type="file" id="image" name="image" accept="image/*" required onchange="showImagePreview(event)" />
                <img id="imagePreview" src="#" alt="Image Preview" style="display:none; max-width: 100%; margin-top: 10px;" />
            </div>
            <div class="form-group">
                <label for="description">Description:</label>
                <textarea id="description" name="description" rows="4" required></textarea>
            </div>
            <button type="submit">Add Progress</button>
        </form>

        <!-- Display each progress update as a card (Moved below the form) -->
        <div class="progress-grid">
            <% progressUpdates.forEach(update => { %>
                <div class="progress-card">
                    <img src="/uploads<%= update.image %>" alt="Progress Image" class="progress-image"/>
                    <p><strong>Description:</strong> <%= update.description %></p>
                    <p><strong>Date:</strong> <%= new Date(update.date).toLocaleDateString() %></p>
                </div>
            <% }); %>
        </div>
    </div>

    <div class="footer">
        <p>&copy; <%= new Date().getFullYear() %> Project Management. All rights reserved.</p>
    </div>

    <script>
        // Set the width of the progress bar dynamically
        document.getElementById("progressBar").style.width = "<%= progressPercentage %>%";

        // Show image preview
        function showImagePreview(event) {
            const imagePreview = document.getElementById('imagePreview');
            imagePreview.src = URL.createObjectURL(event.target.files[0]);
            imagePreview.style.display = 'block';
        }
    </script>
</body>
</html>
